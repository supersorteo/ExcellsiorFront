 <div class="row mb-4">
      <div class="col-12">
        <h2 class="h4 mb-3">Reportes y Estadísticas</h2>
      </div>
    </div>

    <!-- Estadísticas Generales -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card stats-card">
          <div class="card-body text-center">
            <div class="stats-number text-primary">{{totalSpaces}}</div>
            <div class="stats-label">Total Espacios</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card">
          <div class="card-body text-center">
            <div class="stats-number text-success">{{occupiedSpaces}}</div>
            <div class="stats-label">Ocupados</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card">
          <div class="card-body text-center">
            <div class="stats-number text-info">{{freeSpaces}}</div>
            <div class="stats-label">Libres</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stats-card">
          <div class="card-body text-center">
            <div class="stats-number text-warning">{{occupancyRate}}%</div>
            <div class="stats-label">Ocupación</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Por Subsuelo -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Estado por Subsuelo</h5>
        <div class="table-responsive">
          <table class="table table-dark table-striped">
            <thead>
              <tr>
                <th>Subsuelo</th>
                <th>Total</th>
                <th>Ocupados</th>
                <th>Libres</th>
                <th>% Ocupación</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stat of subsueloStats">
                <td>{{stat.label}}</td>
                <td>{{stat.total}}</td>
                <td>
                  <span class="badge bg-danger">{{stat.occupied}}</span>
                </td>
                <td>
                  <span class="badge bg-success">{{stat.free}}</span>
                </td>
                <td>
                  <div class="progress" style="height: 20px;">
                    <div class="progress-bar"
                         [style.width.%]="stat.occupancyRate"
                         [class]="getProgressBarClass(stat.occupancyRate)">
                      {{stat.occupancyRate}}%
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>


<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <!--h5-- class="card-title mb-0">Servicios del día ({{filteredClients.length}})</!--h5-->
      <h5 class="card-title mb-0">Servicios del día {{todayDate()}} ({{todaysClients.length}})</h5>
      <div class="input-group" style="width: 300px;">
        <input type="text" class="form-control" placeholder="Buscar cliente..." [(ngModel)]="searchTerm" (input)="onSearchClients()">
      </div>
    </div>
    <div class="table-responsive" *ngIf="filteredClients.length > 0">
      <table class="table table-dark table-striped">
        <thead>
          <tr>
            <th>Código</th>
            <th>Cliente</th>
            <th>Espacio</th>
            <th>Teléfono</th>
            <th>Vehículo</th>
            <th>Categoría</th>
            <th>Precio</th>
            <th>Tiempo</th>
            <th>info</th>
          </tr>
        </thead>
        <tbody>
          <!--tr *ngFor="let client of paginatedClients"-->
            <tr *ngFor="let client of paginatedTodaysClients">
            <td>
              <span class="code-badge">{{client.code}}</span>
            </td>
            <td>{{client.name}}</td>
            <td>
              <span class="badge bg-info">{{$any(client).spaceDisplayName}}</span>
            </td>
            <td>+{{client.phoneIntl}}</td>
            <td>{{client.vehicle || '-'}}</td>
            <td>
      <span class="badge" [ngClass]="{
        'bg-primary': client.category === 'SUV',
        'bg-success': client.category === 'AUTO',
        'bg-warning': client.category === 'PICKUP',
        'bg-danger': client.category === 'ALTO PORTE',
        'bg-secondary': client.category === 'MOTO' || !client.category
      }">
        {{ client.category || 'Sin categoría' }}
      </span>
    </td>

            <td>
              <strong class="text-success">${{client.price ? client.price.toLocaleString() : 'Pendiente'}}</strong>
            </td>
            <td>
              <span class="text-warning">{{getElapsedTime(client.spaceKey)}}</span>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-warning" type="button" (click)="openEditClient(client)">
                editar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <nav aria-label="Paginación de clientes">
        <ul class="pagination justify-content-center cursor-pointer">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="setPage(currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of pageNumbers" [class.active]="page === currentPage">
            <a class="page-link" (click)="setPage(page)">{{page}}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="setPage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>
    </div>
    <div *ngIf="filteredClients.length === 0" class="text-center text-muted py-4">
      No hay clientes actualmente
    </div>
  </div>
</div>


<!--div-- class="client-edit-modal" *ngIf="isEditClientOpen">
  <div class="client-edit-modal__backdrop" (click)="closeEditClient()"></div>
  <div class="client-edit-modal__content" role="dialog" aria-modal="true">
    <div class="client-edit-modal__header">
      <h3 class="client-edit-modal__title">Editar cliente</h3>
      <button class="btn btn-outline-light btn-sm" type="button" (click)="closeEditClient()">Cerrar</button>
    </div>
    <div class="client-edit-modal__body">
      <div class="client-edit-modal__grid">
        <div class="client-edit-modal__field">
          <label class="form-label">Valor</label>
          <input class="form-control" type="number" [(ngModel)]="editForm.valor">
        </div>
        <div class="client-edit-modal__field">
          <label class="form-label">Clave</label>
          <input class="form-control" type="text" [(ngModel)]="editForm.clave">
        </div>
        <div class="client-edit-modal__field">
          <label class="form-label">Clover</label>
          <input class="form-control" type="number" [(ngModel)]="editForm.clover">
        </div>
        <div class="client-edit-modal__field client-edit-modal__field--wide">
          <label class="form-label">Metodo de pago</label>
          <select class="form-select" [(ngModel)]="editForm.metodoPago">
            <option value="efectivo">Efectivo</option>
            <option value="credito">Credito</option>
            <option value="prepago">Prepago</option>
          </select>
        </div>
      </div>
    </div>
    <div class="client-edit-modal__footer">
      <button class="btn btn-outline-info" type="button" (click)="acceptEditClient()">Aceptar</button>
    </div>
  </div>
</!--div-->

<div class="client-edit-modal" *ngIf="isEditClientOpen">
  <div class="client-edit-modal__backdrop" (click)="closeEditClient()"></div>

  <div class="client-edit-modal__content">
    <div class="client-edit-modal__header d-flex justify-content-between align-items-center px-4 py-3 border-bottom">
      <h3 class="client-edit-modal__title mb-0 fw-semibold">
        <i class="fas fa-edit me-2 text-primary"></i>
        Editar cliente
      </h3>
      <button
        class="btn-close btn-close-white"
        type="button"
        (click)="closeEditClient()"
        aria-label="Cerrar">
      </button>
    </div>

    <div class="client-edit-modal__body p-4">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-medium">Valor</label>
          <div class="input-group">
            <span class="input-group-text">$</span>
            <input
              class="form-control"
              type="number"
              [(ngModel)]="editForm.valor"
              min="0">
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label fw-medium">Clave</label>
          <input
            class="form-control"
            type="text"
            [(ngModel)]="editForm.clave"
            disabled
            placeholder="Ej: C-ABC123">
        </div>

        <!--div-- class="col-md-6">
          <label class="form-label fw-medium">Clover</label>
          <input
            class="form-control"
            type="number"
            [(ngModel)]="editForm.clover"
            placeholder="ID de transacción Clover">
        </!--div-->

        <div class="col-md-6">
  <label class="form-label fw-medium">Clover</label>
  <input
    class="form-control"
    type="text"
    [(ngModel)]="editForm.clover"
    placeholder="1234"
    maxlength="4"
    pattern="[0-9]{4}"
    inputmode="numeric"
    title="Código Clover de 4 dígitos">
  <div class="form-text small text-muted">
    Código de 4 dígitos (ej: 5678)
  </div>

  <!-- Validación movida al TS -->
  <div class="text-danger small mt-1" *ngIf="isCloverInvalid()">
    Debe ser exactamente 4 números
  </div>
</div>

        <div class="col-md-6">
          <label class="form-label fw-medium">Método de pago</label>
          <select class="form-select" [(ngModel)]="editForm.metodoPago">
            <option value="efectivo">Efectivo</option>
            <option value="credito">Crédito</option>
            <option value="prepago">Prepago</option>
          </select>
        </div>
      </div>
    </div>

    <div class="client-edit-modal__footer d-flex justify-content-end gap-2 px-4 py-3 border-top">
      <button class="btn btn-secondary" type="button" (click)="closeEditClient()">
        Cancelar
      </button>
      <button
        class="btn btn-primary"
        type="button"
        (click)="acceptEditClient()">
        <i class="fas fa-save me-2"></i>
        Guardar cambios
      </button>
    </div>
  </div>
</div>

    <!-- Espacios por Tiempo -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Tiempo de Ocupación</h5>
        <div class="row">
          <div class="col-md-4">
            <div class="time-stat">
              <div class="time-number text-success">{{timeStats.under1h}}</div>
              <div class="time-label">Menos de 1h</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="time-stat">
              <div class="time-number text-warning">{{timeStats.between1h3h}}</div>
              <div class="time-label">1h - 3h</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="time-stat">
              <div class="time-number text-danger">{{timeStats.over3h}}</div>
              <div class="time-label">Más de 3h</div>
            </div>
          </div>
        </div>
      </div>
    </div>



<div class="card shadow-lg border-0 mb-4" style="background: linear-gradient(135deg, #1e293b 0%, #16213e 100%); border-radius: 16px;">
  <div class="card-body p-4 p-md-5">
    <!-- Título con icono -->
    <div class="d-flex align-items-center mb-4">
      <i class="bi bi-clock-history text-primary me-3" style="font-size: 1.8rem;"></i>
      <h5 class="card-title mb-0 text-gradient" style="background: linear-gradient(90deg, #0ea5e9, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        Reporte Diario Automático
      </h5>
    </div>

    <!-- Contenido principal -->
    <div class="row g-3 align-items-end">
      <!-- Selector de hora -->
      <div class="col-12 col-md-4 col-lg-3">
        <label class="form-label text-light fw-medium mb-2">
          <i class="bi bi-calendar-event me-2"></i>Hora programada
        </label>
        <input
          type="time"
          class="form-control form-control-lg shadow-sm"
          style="background: #1e293b; border: 1px solid #334155; color: #e2e8f0;"
          [(ngModel)]="scheduledTime"
          (change)="saveScheduledTime()"
          placeholder="HH:MM">
      </div>

      <!-- Botones de acción -->
      <div class="col-12 col-md-8 col-lg-9">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-outline-warning btn-lg px-4 shadow-sm" (click)="generateAndSaveReport(true)">
            <i class="bi bi-file-earmark-arrow-up me-2"></i>
            Generar Manual + Guardar
          </button>

          <!-- Comentado pero listo para usar
          <button class="btn btn-outline-secondary btn-lg px-4 shadow-sm" (click)="generateReport()">
            <i class="bi bi-download me-2"></i>
            Solo Descargar
          </button>
          -->

          <button class="btn btn-outline-success btn-lg px-4 shadow-sm" (click)="exportData()">
            <i class="bi bi-box-arrow-in-down-right me-2"></i>
            Exportar JSON
          </button>

          <button class="btn btn-outline-info btn-lg px-4 shadow-sm" (click)="toggleReportsList()">
            <i class="bi bi-list-ul me-2"></i>
            {{ showReportsList ? 'Ocultar Reportes' : 'Ver Reportes' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Estado del próximo reporte -->
    <div class="mt-4 p-3 rounded-3" style="background: rgba(14, 165, 233, 0.1); border-left: 4px solid #0ea5e9;">
      <div class="d-flex align-items-center">
        <i class="bi bi-info-circle-fill text-info me-3" style="font-size: 1.4rem;"></i>
        <div>
          <strong class="text-light">Próximo reporte automático:</strong>
          <span class="ms-2 text-primary fw-bold">
            <span *ngIf="scheduledTime; else noProgramado">
              Todos los días a las {{ scheduledTime }}
            </span>
            <ng-template #noProgramado>
              <span class="text-warning">No programado</span>
            </ng-template>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>





    <app-reports-list *ngIf="showReportsList"></app-reports-list>
